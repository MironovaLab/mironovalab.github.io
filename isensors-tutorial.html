<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>iSensors Tutorial | Mironova Lab</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">

<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="index.html">Mironova Lab</a>

    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="research.html">Research</a></li>
        <li class="nav-item"><a class="nav-link" href="resources.html">Resources</a></li>
        <li class="nav-item"><a class="nav-link" href="profile.html">Profile</a></li>
      </ul>
    </div>
  </div>
</nav>

<header class="bg-success text-white py-5">
  <div class="container text-center">
    <h1 class="h3 mb-2">iSensors R package tutorial</h1>
    <p class="mb-0 opacity-75">scRNA-seq workflow in Seurat: scoring, visualization, and replicate-aware testing</p>
  </div>
</header>

<main class="container my-5" style="max-width: 900px;">
<!-- Intro -->
<section class="mb-4 section-anchor" id="intro">
  <div class="callout">
    <div class="row align-items-center g-4">

      <!-- Logo column -->
      <div class="col-md-2 text-center">
        <img
          src="assets/images/iSensors-logo.png"
          alt="iSensors logo"
          class="img-fluid"
          style="max-width: 130px;">
      </div>

      <!-- Text column -->
      <div class="col-md-10">
        <p class="mb-2">
          This tutorial demonstrates an end-to-end workflow to apply
          <strong>iSensors R package</strong> to a
          <strong>single-cell RNA-seq (scRNA-seq)</strong> dataset stored as a
          <strong>Seurat</strong> object.
          You will compute integrative sensors (iSensors) activity scores from predefined gene panels,
          visualize iSensors activity across cells and cell clusters, identify sensors that best discriminate cell clusters, and construct custom iSensors for user-defined biological processes.
        </p>
        <ul class="mb-0">
          <li>Input: Seurat object (<code class="inline">seu</code>)</li>
          <li>Output: iSensors assays in the Seurat object with per-cell scores, plus figures and differential iSensor results.</li>
        </ul>
      </div>

    </div>
  </div>
</section>


  <!-- Table of contents -->
  <section class="mb-5 toc section-anchor" id="toc">
    <h2 class="h5">Contents</h2>
    <div class="row g-3">
      <div class="col-md-6">
        <ol class="mb-0">
          <li><a href="#install">Install & load packages</a></li>
          <li><a href="#load">Load scRNA-seq Seurat object</a></li>
          <li><a href="#panels">Load iSensors</a></li>
          <li><a href="#score">Compute iSensor scores</a></li>
        </ol>
      </div>
      <div class="col-md-6">
        <ol start="6" class="mb-0">
          <li><a href="#viz">Visualize sensor activity</a></li>
          <li><a href="#diff">Differential sensor activity</a></li>
          <li><a href="#bestpractices">Construct custom iSensors</a></li>
          <li><a href="#sessioninfo">Best practices & common pitfalls</a></li>
        </ol>
      </div>
    </div>
  </section>

  <!-- 1) Install -->
  <section class="mb-5 section-anchor" id="install">
    <h2 class="h4">1) Install & load packages</h2>
    <p class="text-muted">
      Install iSensors from GitHub and load core dependencies. If you already have these packages, skip installation.
    </p>

  <div class="code-block position-relative">
  <button class="btn btn-sm btn-outline-secondary copy-btn">Copy</button>
    <pre><code class="language-r"># Core packages
install.packages(c("Seurat", "Matrix", "tidyverse", "magrittr", "purrr", "stringr", devtools))

# Bioconductor dependency used by iSensors for generating cis-sensors
if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")
BiocManager::install("Biostrings")

# Install iSensors from GitHub
devtools::install_github("MironovaLab/iSensors")

library(Seurat)
library(iSensors)
library(tidyverse)
</code></pre>
</div>
  </section>

  <!-- 2) Load -->
  <section class="mb-5 section-anchor" id="load">
    <h2 class="h4">2) Load your scRNA-seq Seurat object</h2>
    <p class="text-muted small">
      Load your processed scRNA-seq Seurat object (after QC, normalization and scaling).  </p>

<div class="code-block position-relative">
  <button class="btn btn-sm btn-outline-secondary copy-btn">Copy</button>
    <pre><code class="language-r">seurat_obj <- readRDS("path/to/your_scRNAseq_seurat.rds")

DefaultAssay(seurat_obj) <- "RNA"
DimPlot(seurat_obj)
</code></pre>
</div>
  </section>
  
<section>
  <p class="text-muted small">
    In this tutorial, we analyze a subset of an auxin-treated
    <em>Arabidopsis thaliana</em> single-cell transcriptomics dataset
    originally published in
    <a href="https://www.cell.com/cell/abstract/S0092-8674(25)00346-0" target="_blank" rel="noopener">Martin-Arevalillo et al., 2025</a>.
    The complete dataset is available via
    <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE241573" target="_blank" rel="noopener">GEO</a> database.
  </p>

  <p class="text-muted small">
    For didactic purposes, we provide a reannotated piece of the dataset for the root stem cell niche, as a lightweight reclustered
    <a href="https://github.com/MironovaLab/iSensors-supplementary/tree/main/Tutorial-iSensors/data" target="_blank" rel="noopener">Seurat object</a>.
    This reduced dataset is intended solely for demonstration and tutorial use.
    Annotation quality is not guaranteed. Use this  <a href="https://github.com/MironovaLab/iSensors-supplementary/blob/main/Tutorial-iSensors/iSensors-tutorial-test-load.R" target="_blank" rel="noopener">script</a> to load the object.
  </p>
  
    <img
    src="assets/images/DimPlot_stemcellniche_auxin.png"
    alt="Auxin-treated Arabidopsis stem cell niche (UMAP)"
    class="img-fluid mb-3"
    style="max-width: 650px;">
</section>

  <!-- 3) Panels -->
  <section class="mb-5 section-anchor" id="panels">
    <h2 class="h4">3) Load iSensors</h2>
    <p class="text-muted small">
      Load the gene panel set you want to score. The example below shows loading auxin-related panels for Arabidopsis. Adjust <code class="inline">species</code> and
      <code class="inline">hormone</code> to your use case. As a negative control, three random panels of different sizes are loaded in addition to the whole genomic trend (the aggregated expression pattern of the whole genome).
    </p>

<div class="code-block position-relative">
  <button class="btn btn-sm btn-outline-secondary copy-btn">Copy</button>
    <pre><code class="language-r">panel_set <- LoadSensors(setName = 'AuxinPanel', 
                         species = 'AT', 
                         hormone = 'aux', 
                         randomInfo = list('n' = 3, 'sizes' = c(100, 200, 300), 
                         majortrend = TRUE))
summary(panel_set$panels)</code></pre>
</div>
    <p class="text-muted small">
    This command load panels available for the organism and hormone. In the test case it loads 67 auxin-related iSensors developed for Arabidopsis. Below we will discuss how to explore iSensors and create custom ones.
    </p>
    <img
    src="assets/images/screenshot-load-panels.png"
    alt="Screenshot-load-panels"
    class="img-fluid mb-3"
    style="max-width: 600px;">
  </section>

  <!-- 4) Score -->
  <section class="mb-5 section-anchor" id="score">
    <h2 class="h4">4) Compute iSensors</h2>
    <p class="text-muted small">
      Compute sensor activity scores with <code class="inline">CalcSensors()</code> function.
    </p>

<div class="code-block position-relative">
  <button class="btn btn-sm btn-outline-secondary copy-btn">Copy</button>
    <pre><code class="language-r">seu_is <- CalcSensors(
  seurat_obj,
  seurLayer = "data",
  panelSet = panel_set,
  signals = "mean_normed"
)
Assays(seu_is)</code></pre>

</div>
    <div class="callout">
      <h3  class="text-muted small">Layer and function choice</h3>
      <ul  class="text-muted small">
        <li><strong>Recommended default</strong>: compute iSensors on <code class="inline">seurLayer = "data"</code> (log-normalized).</li>
        <li>If using SCT, you can still compute sensors on RNA <code class="inline">data</code> for interpretability.</li>
        <li>To calculate iSensors use <code class="inline">mean_normed</code> or <code class="inline">median_normed</code>, both show good results in our tests. </li>
    </div>
    <p  class="text-muted small">
      Tip:  The gene identifier format mismatch between iSensors and Seurat object is the main cause of CalcSensors failures, make sure the formatting is consistent</li>.
    </p>
  </section>

  <!-- 5) Visualization -->
  <section class="mb-5 section-anchor" id="viz">
    <h2 class="h4">5) Visualize iSensors activity</h2>
    <p  class="text-muted small">
    After you set <code class="inline">DefaultAssay</code> to the assay containing iSensors, you may apply standard <code class="inline">Seurat</code> functions for analytics and vizualization. 
    </p>
    <h3 class="h6">5.1 FeaturePlot</h3>
    <p  class="text-muted small">
      Select one or several iSensor feature names and visualize it on your embedding (UMAP/tSNE). In the example below we chose three iSensors, all pointing out to higher auxin levels in the initials comparing their doughters. 
    </p>

<div class="code-block position-relative">
  <button class="btn btn-sm btn-outline-secondary copy-btn">Copy</button>
  
    <pre><code class="language-r"># Example: list assays and set the right one before plotting
Assays(seu_is)
# DefaultAssay(seu_is) <- "YOUR_ISENSORS_ASSAY"

sensor_name <- "YOUR_SENSOR_NAME"
FeaturePlot(seu_is, features = sensor_name)</code></pre>
</div>
    <img
    src="assets/images/FeaturePlot_iSensors_3panels_pattern.png"
    alt="FeaturePlot-iSensors"
    class="img-fluid mb-3"
    style="max-width: 800px;">
    
    <h3 class="h6">5.2 Dot Plot</h3>
    <div class="code-block position-relative">
  <button class="btn btn-sm btn-outline-secondary copy-btn">Copy</button>
    <pre><code class="language-r">#Choose your iSensors set 
    sensors<- c("YOUR_SENSOR_NAME1", "YOUR_SENSOR_NAME2", "YOUR_SENSOR_NAME3", ...)
    DotPlot(seu_is, features = sensors) </code></pre></div>
    <p  class="text-muted small">
    The <code class="inline">DotPlot</code> below summarizes iSensor activity across cell types (<code class="inline">group.by = "YOUR_META_IDENT1"</code>) and contrasts conditions using <code class="inline">split.by = "YOUR_META_IDENT2"</code>. This visualization highlights cell-type–specific responses to exogenous auxin; for example, the auxin synthesis iSensor is reduced in putative CEI daughter cells.
    </p>
  <img
    src="assets/images/DotPlot_iSensors_celltypes_split.png"
    alt="FeaturePlot-iSensors"
    class="img-fluid mb-3"
    style="max-width: 800px;">
  </section>

  <!-- 7) Differential -->
  <section class="mb-5 section-anchor" id="diff">
    <h2 class="h4">6) Differential iSensors activity</h2>
    <p class="text-muted small">This section shows how to identify <strong>cell-type–specific iSensors</strong> (i.e., which sensors are enriched in one
      <code class="inline">cluster</code> group versus others) using Seurat’s
      <code class="inline">FindAllMarkers()</code>. Note that <code class="inline">FindAllMarkers()</code> uses per-cell tests; for replicate-aware inference, use pseudobulk models.</p>
<div class="code-block position-relative">
  <button class="btn btn-sm btn-outline-secondary copy-btn">Copy</button>
  <pre class="codeblock"><code class="language-r">is_markers &lt;- FindAllMarkers(
  object = iSensors_obj,
  only.pos = TRUE,        # set FALSE if you also want depleted sensors
  test.use = "wilcox",
  logfc.threshold = 0,    # keep all; filter later
) 
is_markers</code></pre>
</div>
  <div class="callout mt-4">
    <h3 class="text-muted small">Interpretation and caveats</h3>
    <ul class="text-muted small">
      <li><strong>What this tests:</strong> which iSensors best distinguish <code class="inline">cluster</code> groups.</li>
      <li><strong>What this does not test:</strong> If you want to compare treatment control effects within a cell type, use <code class="inline">FindMarkers()</code> per cell type or pseudobulk models.</li>
      <li><strong>Random panels:</strong> per-cell Wilcoxon tests can yield small p-values when cell numbers are large, which may cause negative control (random) panels to appear statistically significant. When possible, such results should be validated using replicate-aware statistics.
.</li>
      <li><strong>Major trend:</strong> similarly to random panels, per-cell statistics may identify the dominant signal as significantly associated with specific cell types. While this can reflect statistical inflation, it may also capture a genuine biological tendency, such as enrichment of the dominant transcriptional program in less differentiated cell populations.</li>
    </ul>
  </div>
</section>

<!-- iSensors marker table (embedded; no external file loading) -->
<section class="mb-5 section-anchor" id="isensors-markers-table">
  <h2 class="text-muted small">iSensors example marker table</h2>

  <p class="text-muted small">
    The table below summarizes marker statistics for auxin-related iSensors in the <strong>Initials</strong> cluster, comparing auxin-treated and control conditions. Differential activity was tested using Seurat’s <code class="inline">FindMarkers()</code> with <code class="inline">ident.1 = "Aux"</code> and <code class="inline">ident.2 = "Ctr"</code>. The full script used to generate the figures and statistical results is available <a href="https://github.com/MironovaLab/iSensors-supplementary/blob/main/Tutorial-iSensors/iSensors-tutorial-calculation.R">here</a>. Overall, these results suggest that exogenous auxin treatment does not increase—and may reduce—auxin-related iSensor activity in initials, whereas increases are observed in other tissues (not shown). However, because negative control panels show a similar decrease, these findings should be interpreted with caution and ideally validated using replicate-aware statistical approaches.
  </p>

  <div class="table-responsive">
    <table id="isensorsTable" class="table table-sm table-striped table-hover align-middle" style="width:100%">
      <thead class="table-light">
        <tr>
          <th>iSensor</th>
          <th>p_val</th>
          <th>avg_log2FC</th>
          <th>pct.1</th>
          <th>pct.2</th>
          <th>p_val_adj</th>
          <th>celltype</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>AT-aux-trans-IAA</td><td>2.47E-12</td><td>-2.028909326</td><td>1</td><td>1</td><td>1.65E-10</td><td>Initials</td></tr>
        <tr><td>AT-aux-cis-DR5-TGTCNN</td><td>4.71E-11</td><td>-0.463153022</td><td>1</td><td>1</td><td>3.16E-09</td><td>Initials</td></tr>
        <tr><td>AT-aux-cis-IR8-ARF1</td><td>3.48E-10</td><td>-0.578596218</td><td>1</td><td>1</td><td>2.33E-08</td><td>Initials</td></tr>
        <tr><td>AT-aux-cis-DR5-ARF6</td><td>6.22E-10</td><td>-0.362692887</td><td>1</td><td>1</td><td>4.17E-08</td><td>Initials</td></tr>
        <tr><td>AT-aux-cistrans-DR5-ARF6-down</td><td>1.17E-08</td><td>-0.714474289</td><td>1</td><td>1</td><td>7.82E-07</td><td>Initials</td></tr>
        <tr><td>majortrend</td><td>1.39E-08</td><td>-0.280484864</td><td>1</td><td>1</td><td>9.34E-07</td><td>Initials</td></tr>
        <tr><td>random3</td><td>1.30E-07</td><td>-0.306833108</td><td>1</td><td>1</td><td>8.70E-06</td><td>Initials</td></tr>
        <tr><td>AT-aux-trans-Synthesis</td><td>7.16E-07</td><td>-1.210907316</td><td>0.988</td><td>1</td><td>4.80E-05</td><td>Initials</td></tr>
        <tr><td>AT-aux-trans-Transport</td><td>0.001018649</td><td>-0.606882778</td><td>1</td><td>1</td><td>0.068249466</td><td>Initials</td></tr>
        <tr><td>AT-aux-trans-ARF</td><td>0.646297247</td><td>0.046301397</td><td>0.988</td><td>1</td><td>1</td><td>Initials</td></tr>
      </tbody>
    </table>
  </div>

  <!-- DataTables (optional but recommended for search/sort/paging) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/datatables.net-dt@1.13.8/css/jquery.dataTables.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/datatables.net@1.13.8/js/jquery.dataTables.min.js"></script>

  <script>
    $(function () {
      $("#isensorsTable").DataTable({
        pageLength: 10,
        order: [[5, "asc"]],  // sort by adjusted p-value (p_val_adj)
        scrollX: true
      });
    });
  </script>
</section>


<!-- Best practices -->
  <section class="mb-5 section-anchor" id="bestpractices">
    <h2 class="h4">7) Construct custom iSensors</h2>
 <p class="text-muted small">
   The iSensors project develops and validates sensors for a range of biological responses; however, it is not feasible to cover all possible processes within a single resource. Users are therefore encouraged to construct custom iSensors tailored to their specific research questions and biological systems. Two helper functions are provided for this purpose: <code class="inline">iSensorsTransPanelCreate()</code>, which generates a panel from a user-defined gene list, and <code class="inline">iSensorsCisTransPanelCreate()</code>, which builds panels based on motif search results. Both functions create an <code class="inline">iSensors</code> directory in the working folder and automatically save the resulting panels there. 
   </p>
<div class="code-block position-relative">
  <button class="btn btn-sm btn-outline-secondary copy-btn">Copy</button>
  <pre class="codeblock"><code class="language-r">iSensorsTransPanelCreate(panel_name = 'customTransPanel', 
                         gene_list = c('AT1G01010', 'AT1G01030', 'AT1G01040'), 
                         species = 'Arabidopsis thaliana', 
                         panel_description = 'Arabidopsis_trans_panel_with_3_genes')
                         
                         customTransPanel <- LoadSensors(setName = 'customTransPanelSet',
                         customPanels = TRUE,
                         randomInfo = list('n' = 3, 'sizes' = c(100, 200, 300),
                        majortrend = TRUE))
                        
  result <- CalcSensors(seu,
                      seurLayer = "data",
                      panelSet = customTransPanel,
                      signals = "mean_normed")</code></pre>
</div>

      <ul class="text-muted small">
      <li><strong>Be sure that the panel gene formating is consistent with features in your Seurat dataset.</li>
      <li>You can calculate default and custom panels at the same time.</li>
    </ul>
  </section>
  
  
  <!-- Best practices -->
  <section class="mb-5 section-anchor" id="bestpractices">
    <h2 class="h4">8) Best practices & common pitfalls</h2>

    <ul calss = "text-muted small">
      <li>Ensure the gene formatting in your Seurat object matches the one in panels. Adjust when needed</li>
      <li>Prefer replicate-aware inference</strong>: pseudobulk per sample (and per cell type) rather than per-cell p-values.</li>
      <li><strong>Document the layer</strong> used to compute sensors (<code class="inline">data</code> vs <code class="inline">counts</code> vs SCT).</li>
      <li><strong>Control panels</strong>: consider random panels for empirical calibration if your study emphasizes discovery.</li>
    </ul>
  </section>


</main>

<script src="js/research.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.querySelectorAll(".copy-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const code = btn.nextElementSibling.querySelector("code").innerText;
    navigator.clipboard.writeText(code).then(() => {
      btn.textContent = "Copied!";
      setTimeout(() => btn.textContent = "Copy", 1200);
    });
  });
});
</script>
</body>
</html>
